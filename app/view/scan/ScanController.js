Ext.define('VulnerabilityScannerClient.view.scan.ScanController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.scan-controller',

    reset: function () {
        this.getView().reset();
    },

    submit: function () {
        var form = this.getView();
        var values = form.getValues();
        var url = values.url;
        Ext.Ajax.request({
            url: 'http://192.168.239.128:1841/wordpressScan?url=' + url,
            method: "GET",
            useDefaultXhrHeader : false,
            headers: {
                'Content-Type': 'application/json',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'HEAD, GET, POST, PUT, PATCH, DELETE',
                'Access-Control-Allow-Headers': '*'
            },
    
            success: function (response, opts) {
                var obj = Ext.decode(response.responseText);
                console.dir(obj);

                Ext.create('Ext.data.JsonStore', {
                    storeId: 'store.vulnerabilities',
                    proxy: {
                        type: 'memory',
                        reader: {
                            type: 'json'
                        }
                    }
                });
            },
    
            failure: function (response, opts) {
                console.log('server-side failure with status code ' + response.status);
            }
        });
    }
});